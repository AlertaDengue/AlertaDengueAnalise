{
    "contents" : "# Organiza dados do SINAN para o Alerta dengue\n#====================================================\n#A serie temporal 2010-13 ja esta pronta. Esse script agrega com a serie de 2014 em diante\n\n#require(foreign)\n\n###Dados do SINAN 2014 e 2015\n#--------------------\n\nd14 <- read.dbf(novosinan2014)[,c(\"DT_NOTIFIC\",\"SEM_NOT\",\"NU_ANO\",\"DT_SIN_PRI\",\"DT_DIGITA\",\n                          \"SEM_PRI\",\"NM_BAIRRO\")]\nd15 <- read.dbf(novosinan2015)[,c(\"DT_NOTIFIC\",\"SEM_NOT\",\"NU_ANO\",\"DT_SIN_PRI\",\"DT_DIGITA\",\n                                  \"SEM_PRI\",\"NM_BAIRRO\")]\nd<-rbind(d14,d15)\n#print(tail(d,n=7))\nd$atraso<-as.numeric(d$DT_DIGITA-d$DT_SIN_PRI)\n\n###Criar variavel APS\n# -----------------\nbaps<-read.csv(\"tabelas/bairro2AP.csv\")\nd2<-merge(d,baps,by.x=\"NM_BAIRRO\",by.y=\"bairro\")\n\n# identificar os casos nos quais nao foram identificados a APS.\nd3<-merge(d,baps,by.x=\"NM_BAIRRO\",by.y=\"bairro\",all.x=TRUE,sort=FALSE)\nnad3 <- d3[which(is.na(d3$APS)),] \nnad3$SEM_NOT <- as.numeric(as.character(nad3$SEM_NOT))\n\nmessage(\"casos perdidos por não geolocalização no MRJ na ultima semana: \",tail(tapply(nad3$SEM_NOT,nad3$SEM_NOT,length),1))\nif(tail(tapply(nad3$SEM_NOT,nad3$SEM_NOT,length),1)>0) print(nad3[nad3$SEM_NOT==max(nad3$SEM_NOT),])\n\n#Numero de registros sem AP (falha no mapeamento bairro -> APS), em quase todas as vezes deve-se a \n# localizacao fora do Rio de Janeiro\n# falha=(dim(d)[1]-dim(d2)[1])/dim(d)[1]*100\n#message(\"% de registros sem geolocalizacao no RJ desde 2014: \",falha,\" %\")\nrm(d3,nad3)\n\n###Serie temporal de casos no municipio\n# ---------------------------------------------------\nst14 <- aggregate(d$SEM_NOT,by=list(d$SEM_NOT),FUN=length)\nnames(st14)<-c(\"SE\",\"casos\")\nst14$SE<-as.numeric(as.character(st14$SE))\nmessage(\"serie temporal da cidade:\")\nprint(tail(st14))\n\n### Atraso de digitacao - A fazer \n#at14 <- aggregate(d$atraso,by=list(d$SEM_NOT),FUN=median)\n#names(at14)<-c(\"SE\",\"medianatraso\")\n#st14$SE<-as.numeric(as.character(st14$SE))\n#message(\"serie temporal da cidade:\")\n#print(tail(st14))\n\n\n###Cria Serie temporal de casos por APS \n# ----------------------------------------------\nlistaAPS<-unique(baps$APS)\n\n# primeiro s´o 2014 em diante\nsem <- unique(d$SEM_NOT)\nst14.ap <- expand.grid(SE=sem,APS=listaAPS)\nst14.ap$casos <- NA\nfor(i in 1:dim(st14.ap)[1]) st14.ap$casos[i]<-length(d2$SEM_NOT[d2$SEM_NOT %in% st14.ap$SE[i] \n                                                                & d2$APS %in% st14.ap$APS[i]])\nst14.ap$SE<-as.numeric(as.character(st14.ap$SE))\n\n# Juntando com dados de anos anteriores\nload(\"dados_brutos/sinan/casos2010-2013.Rdata\")\nst10.13$SE<-as.numeric(as.character(st10.13$SE))\nst10.13.aps$SE<-as.numeric(as.character(st10.13.aps$semana)) # ok\n\nst<-rbind(st10.13,st14)\nst.ap<-rbind(st10.13.aps[,c(4,3,2)],st14.ap) \n\nst<-st[order(st$SE),]\nst.ap <-st.ap[order(st.ap$APS,st.ap$SE),]\nst <- subset(st,SE>=201001)\nst.ap <- subset(st.ap,SE>=201001)\n\n\n#Serie temporal de casos na cidade**\n#plot(st$casos,type='l',ylab=\"casos\",xlab=\"\",axes=FALSE)\n#axis(2)\n#axis(1,at=seq(1,length(st$SE),by=6*4),label=st$SE[seq(1,length(st$SE),by=6*4)],las=2,cex.axis=0.7)\n\n#Serie temporal de casos por APS**\n#plot(st.ap$casos[st.ap$APS==listaAPS[1]],type=\"l\",ylim=1.5*range(st.ap$casos),xlab=\"\",ylab=\"casos\",axes=FALSE)\n#for (j in 2:10) lines(st.ap$casos[st.ap$APS==listaAPS[j]],col=j)\n#axis(2)\n#sem <- sort(unique(st.ap$SE))\n#axis(1,at=seq(1,length(sem),by=6*4),label=sem[seq(1,length(sem),by=6*4)],las=2,cex.axis=0.7)\n#legend(0,1.5*max(st.ap$casos),listaAPS,lty=1,col=1:10,cex=0.6)\n\n\n#Salvando**\nmessage(\"arquivo casos salvo: dadoslimpos/sinansemanaAP_RJ.csv\")\nwrite.table(st.ap,file=\"dados_limpos/sinansemanaAP_RJ.csv\",sep=\",\",row.names=FALSE)\nwrite.table(st,file=\"dados_limpos/sinansemana_RJ.csv\",sep=\",\",row.names=FALSE)\n\n",
    "created" : 1444506015832.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1258091676",
    "id" : "24DC860D",
    "lastKnownWriteTime" : 1443042835,
    "path" : "~/Documentos/AlertaDengueAnalise/GeraAlerta/organizaDados/organizasinan.r",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}